# Snakemake pipeline for the calling and genotyping of genomic Structural Variants based long-read sequencing

**Authors: Thomas Brazier<sup>1</sup>, Lune Angevin<sup>1</sup>, Claire Lemaitre<sup>2</sup> and Claire Mérot<sup>1</sup>**

*Institutions: (1) UMR 6553 ECOBIO, University of Rennes (2) GenScale Team, IRISA-INRIA lab, University of Rennes*

This pipeline performs ensemble calling of Structural Variants (SV) from long-read sequencing of a single individual. SV calling is performed by three different tools: SVIM, Sniffles and CuteSV. The three callsets are then merged with Jasmine/IRIS and SVs are genotyped with SVJediGraph.



## Installing the pipeline

The following dependencies must be installed before launching the pipeline:
* conda
* snakemake

```
conda create -c conda-forge -n snakemake snakemake mamba
conda activate snakemake
```

Then you can clone the github repository where you wish to run analyses.

```
git clone https://github.com/thomasbrazier/evolsv.git
cd evolsv
```

## Using the pipeline

You can launch the pipeline in two ways: either by running the *launcher.sh* script (where you can configure your setting if you are using a SLURM job scheduler), or simply by executing the following command in the terminal:

```
snakemake --snakefile workflow/Snakefile --config config/config.yaml --use-conda --conda-frontend "mamba"
```

## Data directory setup

Project data can be stored in the current `EvolSV` git directory. The place where is the *data/* directory must be specified in the parameter `workingdir` in *config.yaml*. The default is `workingdir: ''` which assumes *data/* to be in te current *evolsv/* directory (see below).

```
.
├── evolsv/
│   ├── config/
│   │   ├── config.yaml
│   ├── workflow/
│   ├── data/
```


### Configuration file

A YAML configuration file named *config/config.yaml* is used to specify the settings of the different filtering and tools performed during the analysis. The config file is saved at the beginning of the run for reproducibility purposes.


### Core configuration

The following options in *config/config.yaml* must be set before running EvolSV:
* sra, the ERR accession from SRA database
* genome, the GCA accession from NCBI Assembly database


## Output file

The output file is a VCF file containing the list of SVs, named *ERRxxx_finalcallset.vcf*. It is the result of merging the three SV catalogues generated by the SVIM, Sniffles and CuteSV tools. You can also access each catalogue individually, named *ERRxxx_toolsname.vcf*.


## Additional folders

The *workflow/envs* folder contains the yaml files used to create the conda environments needed to run the pipeline. The *workflow/scripts* folder contains the individual scripts called during the pipeline.


## References

Danecek, Petr, et al. « Twelve Years of SAMtools and BCFtools ». GigaScience, vol. 10, nᵒ 2, janvier 2021, p. giab008. DOI.org (Crossref), https://doi.org/10.1093/gigascience/giab008.

Heller, David, et Martin Vingron. « SVIM: Structural Variant Identification Using Mapped Long Reads ». Bioinformatics, édité par Inanc Birol, vol. 35, nᵒ 17, septembre 2019, p. 2907‑15. DOI.org (Crossref), https://doi.org/10.1093/bioinformatics/btz041.

Jiang, Tao, et al. « Long-Read-Based Human Genomic Structural Variation Detection with cuteSV ». Genome Biology, vol. 21, nᵒ 1, décembre 2020, p. 189. DOI.org (Crossref), https://doi.org/10.1186/s13059-020-02107-y.

Kirsche, Melanie, et al. « Jasmine and Iris: Population-Scale Structural Variant Comparison and Analysis ». Nature Methods, vol. 20, nᵒ 3, mars 2023, p. 408‑17. DOI.org (Crossref), https://doi.org/10.1038/s41592-022-01753-3.

Li, Heng. « Minimap2: Pairwise Alignment for Nucleotide Sequences ». Bioinformatics, édité par Inanc Birol, vol. 34, nᵒ 18, septembre 2018, p. 3094‑100. DOI.org (Crossref), https://doi.org/10.1093/bioinformatics/bty191.

Sedlazeck, Fritz J., et al. « Accurate Detection of Complex Structural Variations Using Single-Molecule Sequencing ». Nature Methods, vol. 15, nᵒ 6, juin 2018, p. 461‑68. DOI.org (Crossref), https://doi.org/10.1038/s41592-018-0001-7.
